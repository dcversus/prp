# PRP-003 Telegram Integration - Architecture Diagrams

Visual reference for understanding the integration architecture.

---

## 1. High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PRP CLI Ecosystem                           â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚   User's CLI    â”‚  $ prp init my-project                        â”‚
â”‚  â”‚   (Terminal)    â”‚                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ 1. Generate project                                    â”‚
â”‚           â†“                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  PRP Generator  â”‚  TypeScript/Node.js                          â”‚
â”‚  â”‚   (src/*)       â”‚  - CLI logic                                 â”‚
â”‚  â”‚                 â”‚  - Template engine                            â”‚
â”‚  â”‚                 â”‚  - File operations                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ 2. Project created                                     â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ 3. Send notification                                   â”‚
â”‚           â†“                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚ Telegram Utils  â”‚  src/utils/telegram.ts                       â”‚
â”‚  â”‚ sendNudge()     â”‚  - HTTP client                               â”‚
â”‚  â”‚                 â”‚  - Authentication                             â”‚
â”‚  â”‚                 â”‚  - Error handling                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ HTTP POST
            â”‚ Authorization: Bearer <NUDGE_SECRET>
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    dcmaidbot Infrastructure                         â”‚
â”‚                         (Kubernetes)                                â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚   Ingress HTTPS â”‚  dcmaidbot.shark-versus.com                  â”‚
â”‚  â”‚   (Cert-Manager)â”‚  SSL/TLS termination                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â”‚           â†“                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  Service (K8s)  â”‚  ClusterIP                                   â”‚
â”‚  â”‚  Port 8080      â”‚  Load balancing                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â”‚           â†“                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  Pod (Docker)   â”‚  Python 3.13 container                       â”‚
â”‚  â”‚  bot_webhook.py â”‚  - aiohttp web server                        â”‚
â”‚  â”‚                 â”‚  - /nudge handler                             â”‚
â”‚  â”‚                 â”‚  - /health, /version                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ 1. Validate auth                                       â”‚
â”‚           â”‚ 2. Validate payload                                    â”‚
â”‚           â”‚                                                         â”‚
â”‚           â†“                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  NudgeService   â”‚  services/nudge_service.py                   â”‚
â”‚  â”‚  forward_nudge()â”‚  - Build request                             â”‚
â”‚  â”‚                 â”‚  - HTTP client                                â”‚
â”‚  â”‚                 â”‚  - Timeout handling                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ HTTP POST
            â”‚ Authorization: Bearer <NUDGE_SECRET>
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   External LLM Service                              â”‚
â”‚                  dcmaid.theedgestory.org                            â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  /nudge Handler â”‚  External endpoint                           â”‚
â”‚  â”‚                 â”‚  - Parse request                              â”‚
â”‚  â”‚                 â”‚  - Format message                             â”‚
â”‚  â”‚                 â”‚  - Add context (PR, PRP links)                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â”‚           â†“                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  LLM Processor  â”‚  - Message enrichment                        â”‚
â”‚  â”‚                 â”‚  - Link formatting                            â”‚
â”‚  â”‚                 â”‚  - Urgency handling                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ bot.sendMessage()
            â”‚ via Telegram Bot API
            â”‚
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Telegram Infrastructure                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚ Telegram Bot APIâ”‚  api.telegram.org                            â”‚
â”‚  â”‚                 â”‚  - Message routing                            â”‚
â”‚  â”‚                 â”‚  - Delivery tracking                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚           â”‚                                                         â”‚
â”‚           â†“                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚  User's Device  â”‚  Telegram mobile/desktop app                 â”‚
â”‚  â”‚  @username      â”‚  - Push notification                         â”‚
â”‚  â”‚  ID: 123456789  â”‚  - Message display                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Time: ~1-2 seconds end-to-end
```

---

## 2. Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PRP CLI  â”‚                                    â”‚ dcmaidbotâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                                â”‚
     â”‚ 1. Load NUDGE_SECRET from .env                â”‚
     â”‚    (or environment variable)                  â”‚
     â”‚                                                â”‚
     â”‚ 2. Prepare HTTP request:                      â”‚
     â”‚    POST /nudge                                â”‚
     â”‚    Authorization: Bearer <secret>             â”‚
     â”‚    Content-Type: application/json             â”‚
     â”‚    Body: { user_ids, message, ... }           â”‚
     â”‚                                                â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HTTP POST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                                                â”‚
     â”‚                                    3. Receive request
     â”‚                                    4. Extract auth header
     â”‚                                    5. Load NUDGE_SECRET from env
     â”‚                                    6. Compare:
     â”‚                                       provided == expected?
     â”‚                                                â”‚
     â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                    â”‚                     â”‚
     â”‚                               YES (Match)            NO (Mismatch)
     â”‚                                    â”‚                     â”‚
     â”‚                          7. Proceed with request   7. Return 401
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
     â”‚                                                          â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 401 Unauthorized â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚            { error: "Invalid token" }
     â”‚
     â””â”€ Continue or log error
```

---

## 3. Request/Response Flow (Detailed)

```
PRP CLI                 dcmaidbot               External Service      Telegram
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚ 1. POST /nudge         â”‚                          â”‚                 â”‚
   â”‚ {user_ids, message}    â”‚                          â”‚                 â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚                 â”‚
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚                   2. Validate Auth                â”‚                 â”‚
   â”‚                   (Bearer token)                  â”‚                 â”‚
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚                   3. Validate Payload             â”‚                 â”‚
   â”‚                   (user_ids, message)             â”‚                 â”‚
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚                   4. Forward request              â”‚                 â”‚
   â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
   â”‚                        â”‚  POST /nudge             â”‚                 â”‚
   â”‚                        â”‚  (with same auth)        â”‚                 â”‚
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚                        â”‚              5. Process request            â”‚
   â”‚                        â”‚              - Parse payload               â”‚
   â”‚                        â”‚              - Format message              â”‚
   â”‚                        â”‚              - Add links                   â”‚
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚                        â”‚              6. Send to Telegram           â”‚
   â”‚                        â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                        â”‚                          â”‚ bot.sendMessage â”‚
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚                        â”‚                          â”‚      7. Deliver â”‚
   â”‚                        â”‚                          â”‚      (push notif)
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚                        â”‚              8. Return success              â”‚
   â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
   â”‚                        â”‚  {status: "success"}     â”‚                 â”‚
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚ 9. Return to CLI       â”‚                          â”‚                 â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚                 â”‚
   â”‚ {status: "success"}    â”‚                          â”‚                 â”‚
   â”‚                        â”‚                          â”‚                 â”‚
   â”‚ 10. Log success        â”‚                          â”‚                 â”‚
   â”‚ Continue workflow      â”‚                          â”‚                 â”‚
   â”‚                        â”‚                          â”‚                 â”‚

Total time: ~1-2 seconds
```

---

## 4. Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Error Scenarios                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario A: Missing NUDGE_SECRET in PRP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PRP CLI
   â”‚
   â”œâ”€ Load .env
   â”‚  NUDGE_SECRET not found
   â”‚
   â””â”€> Log warning: "NUDGE_SECRET not configured"
       Skip notification
       Continue workflow âœ… (non-blocking)


Scenario B: Invalid NUDGE_SECRET
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PRP CLI â”€â”€â”€POSTâ”€â”€â”€> dcmaidbot
                         â”‚
                    Validate token
                    provided != expected
                         â”‚
                    Return 401 â”€â”€â”€â”€â”€> PRP CLI
                                         â”‚
                                    Log error
                                    Continue âœ…


Scenario C: Network Timeout
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PRP CLI â”€â”€â”€POSTâ”€â”€â”€> dcmaidbot (unreachable)
   â”‚                     âœ—
   â”‚ Timeout (30s)
   â”‚
   â””â”€> Catch error
       Log: "Failed to send notification"
       Continue âœ…


Scenario D: External Endpoint Down
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PRP CLI â”€â”€â”€> dcmaidbot â”€â”€â”€> External (down)
                â”‚                âœ—
                â”‚ Forward fails
                â”‚
                â””â”€â”€â”€> Return 502 â”€â”€â”€â”€â”€> PRP CLI
                                           â”‚
                                      Log error
                                      Continue âœ…


Scenario E: Invalid User ID
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PRP CLI â”€â”€â”€> dcmaidbot â”€â”€â”€> External â”€â”€â”€> Telegram
                                               â”‚
                                          User not found
                                               â”‚
                                          Error response
                                               â”‚
                                    Return to dcmaidbot
                                               â”‚
                                    Forward error to PRP
                                               â”‚
                                          Log error
                                          Continue âœ…

All scenarios: Notifications NEVER block main workflow!
```

---

## 5. User Account Linking Flow (Future)

```
Step 1: User initiates linking
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ prp link-telegram

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Link your Telegram account              â”‚
â”‚                                          â”‚
â”‚ 1. Open: https://t.me/dcmaidbot?        â”‚
â”‚           start=A1B2C3D4                 â”‚
â”‚                                          â”‚
â”‚ 2. Send /start in Telegram              â”‚
â”‚                                          â”‚
â”‚ Waiting for verification...              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 2: User opens Telegram
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[User clicks link]
    â”‚
    â””â”€> Opens Telegram app
        Pre-fills: /start A1B2C3D4


Step 3: User sends code
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
User in Telegram: /start A1B2C3D4
    â”‚
    â””â”€> dcmaidbot receives:
        - User ID: 123456789
        - Code: A1B2C3D4
        - Username: @john_doe


Step 4: dcmaidbot verifies
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
dcmaidbot
    â”‚
    â”œâ”€> Lookup code in database
    â”‚   Code: A1B2C3D4
    â”‚   Status: pending
    â”‚   Created: 2025-10-28 12:00:00
    â”‚
    â”œâ”€> Validate (not expired, unused)
    â”‚
    â”œâ”€> Mark as verified
    â”‚   User ID: 123456789
    â”‚   Username: @john_doe
    â”‚
    â””â”€> Reply to user:
        "âœ… Verified! You'll receive PRP updates!"


Step 5: PRP confirms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PRP CLI (polling for verification)
    â”‚
    â”œâ”€> Check code status every 5s
    â”‚   GET /api/link-status?code=A1B2C3D4
    â”‚
    â””â”€> Status: verified
        User ID: 123456789
        
        Save to config:
        ~/.prp/config.json
        {
          "telegram": {
            "userId": 123456789,
            "username": "@john_doe",
            "linkedAt": "2025-10-28T12:00:30Z"
          }
        }
        
        Display:
        "âœ… Telegram linked successfully!"


Step 6: Test notification
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PRP CLI
    â”‚
    â””â”€> Send test nudge
        POST /nudge
        {
          "user_ids": [123456789],
          "message": "Test from PRP! ğŸ‰"
        }
        
        User receives on Telegram:
        "Test from PRP! ğŸ‰"
        
        Display:
        "âœ… Test notification sent!"
```

---

## 6. Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Data Transformations                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUT (PRP CLI)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
  userIds: [123456789],
  message: "Project 'my-app' created!",
  urgency: "medium"
}
    â”‚
    â”‚ Transform to HTTP request
    â†“
HTTP REQUEST (PRP â†’ dcmaidbot)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST /nudge
Authorization: Bearer <secret>
Content-Type: application/json

{
  "user_ids": [123456789],
  "message": "Project 'my-app' created!",
  "urgency": "medium"
}
    â”‚
    â”‚ Forward (unchanged)
    â†“
HTTP REQUEST (dcmaidbot â†’ External)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST https://dcmaid.theedgestory.org/nudge
Authorization: Bearer <secret>
Content-Type: application/json

{
  "user_ids": [123456789],
  "message": "Project 'my-app' created!",
  "urgency": "medium"
}
    â”‚
    â”‚ Enrich with formatting
    â†“
TELEGRAM API CALL (External â†’ Telegram)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
bot.sendMessage({
  chat_id: 123456789,
  text: "ğŸ’• dcmaidbot says:\n\n" +
        "Project 'my-app' created!\n\n" +
        "Nya~ Sent by PRP CLI",
  parse_mode: "Markdown"
})
    â”‚
    â”‚ Deliver
    â†“
USER RECEIVES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’• dcmaidbot says:           â”‚
â”‚                              â”‚
â”‚ Project 'my-app' created!    â”‚
â”‚                              â”‚
â”‚ Nya~ Sent by PRP CLI         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Security Boundaries

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Security Layers                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Network
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Internet â”€â”€[HTTPS]â”€â”€> Kubernetes Ingress
                      â”‚
                      â”œâ”€ SSL/TLS termination
                      â”œâ”€ Valid certificate
                      â””â”€ Enforce HTTPS only


Layer 2: Authentication
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HTTP Request â”€â”€[Bearer Token]â”€â”€> dcmaidbot
                                  â”‚
                                  â”œâ”€ Extract token
                                  â”œâ”€ Compare with NUDGE_SECRET
                                  â””â”€ Return 401 if invalid


Layer 3: Input Validation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Request Body â”€â”€[Schema Check]â”€â”€> Handler
                                  â”‚
                                  â”œâ”€ user_ids: list of int?
                                  â”œâ”€ message: non-empty string?
                                  â””â”€ Return 400 if invalid


Layer 4: Rate Limiting (Future)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Request â”€â”€[Check Rate]â”€â”€> Handler
                          â”‚
                          â”œâ”€ Count requests per IP/user
                          â”œâ”€ Max 10/minute per user
                          â””â”€ Return 429 if exceeded


Layer 5: User ID Validation (Future)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
user_ids â”€â”€[Check Allowed]â”€â”€> Handler
                               â”‚
                               â”œâ”€ Only send to admin IDs
                               â””â”€ Return 403 if unauthorized


Layer 6: Kubernetes Secrets
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
NUDGE_SECRET stored in:
    Kubernetes Secret (encrypted at rest)
    â”‚
    â”œâ”€ Not in code
    â”œâ”€ Not in environment files
    â”œâ”€ Not in logs
    â””â”€ Injected at runtime


Layer 7: Logging Privacy
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Log only:
    âœ… Request timestamp
    âœ… HTTP method and path
    âœ… Response status code
    âœ… Error messages (sanitized)

Never log:
    âŒ NUDGE_SECRET
    âŒ User IDs (or hash them)
    âŒ Full message content
    âŒ Authorization headers
```

---

## 8. Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetes Production Setup                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Namespace: prod-core
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Ingress (HTTPS)               â”‚
â”‚  dcmaidbot.shark-versus.com              â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  cert-manager (Let's Encrypt)      â”‚  â”‚
â”‚  â”‚  Auto-renewed SSL certificate      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Service (ClusterIP)              â”‚
â”‚  dcmaidbot-prod                          â”‚
â”‚  Port: 8080                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Deployment                      â”‚
â”‚  dcmaidbot-prod                          â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Pod 1 (Active)             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Container: dcmaidbot        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Image: ghcr.io/dcversus/   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚         dcmaidbot:latest     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Env vars:                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - BOT_TOKEN (secret)        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - ADMIN_IDS (secret)        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - NUDGE_SECRET (secret) âœ¨  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - DATABASE_URL (secret)     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - WEBHOOK_MODE=true         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Health check:               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  GET /health (30s interval)  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Pod 2 (Standby)            â”‚  â”‚
â”‚  â”‚  (Same configuration)              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Secrets (K8s)                   â”‚
â”‚                                          â”‚
â”‚  dcmaidbot-secrets                       â”‚
â”‚  - BOT_TOKEN                             â”‚
â”‚  - ADMIN_IDS                             â”‚
â”‚  - DATABASE_URL                          â”‚
â”‚  - WEBHOOK_SECRET                        â”‚
â”‚                                          â”‚
â”‚  dcmaidbot-nudge-secret âœ¨               â”‚
â”‚  - NUDGE_SECRET                          â”‚
â”‚    (64-char hex, rotated annually)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ArgoCD (GitOps)                 â”‚
â”‚                                          â”‚
â”‚  Syncs from: uz0/core-charts            â”‚
â”‚  Chart: charts/dcmaidbot/               â”‚
â”‚                                          â”‚
â”‚  Auto-deploy on:                         â”‚
â”‚  - Git push to main                      â”‚
â”‚  - Manual sync                           â”‚
â”‚  - Scheduled sync (5 min)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*End of Architecture Diagrams*

Generated for: PRP-003 Telegram Integration Research  
Date: 2025-10-28  
Status: Complete
