name: CHANGELOG Check

on:
  pull_request:
    branches: [main, develop]

jobs:
  changelog-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check CHANGELOG.md updated
        id: check
        run: |
          # Check if CHANGELOG.md was modified
          if git diff --name-only origin/${{ github.base_ref }}...HEAD | grep -q "CHANGELOG.md"; then
            echo "changelog_updated=true" >> $GITHUB_OUTPUT
            echo "âœ… CHANGELOG.md updated! Good job! ğŸ‰"
          else
            echo "changelog_updated=false" >> $GITHUB_OUTPUT
            echo "âŒ CHANGELOG.md not updated! ğŸ“"
          fi

      - name: Verify Unreleased section exists
        if: steps.check.outputs.changelog_updated == 'true'
        run: |
          if grep -q "## \[Unreleased\]" CHANGELOG.md; then
            echo "âœ… [Unreleased] section found! ğŸ¯"
          else
            echo "âš ï¸  No [Unreleased] section found"
            exit 1
          fi

      - name: Enforce CHANGELOG requirement
        if: steps.check.outputs.changelog_updated == 'false'
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“ CHANGELOG.md must be updated!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "âš ï¸  Every PR needs CHANGELOG.md updates!"
          echo ""
          echo "Please add your changes to CHANGELOG.md:"
          echo ""
          echo "## [Unreleased]"
          echo ""
          echo "### Added"
          echo "- Your awesome feature! âœ¨"
          echo ""
          echo "### Changed"
          echo "- What you modified! ğŸ”§"
          echo ""
          echo "### Fixed"
          echo "- Bugs you squashed! ğŸ›"
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ“– See AGENTS.md for release process"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          exit 1

      - name: Success message
        if: steps.check.outputs.changelog_updated == 'true'
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… CHANGELOG.md updated! ğŸ‰"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ“– Thank you for keeping our history!"
          echo "âœ¨ Great contribution!"
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
